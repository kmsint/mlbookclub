parent: [[Работа в jupyter notebook]]

tags: #jupiter #remote #ssh #ml 

### Постановка задачи

Необходимо запустить Jupyter Notebook на удаленном мощном сервере с графической видеокартой от Nvidia с установленной Ubuntu и получить к нему доступ на локальном компьютере, подключившись к серверу по SSH.

1. Необходимо подключиться к удаленному серверу по SSH

```shell
ssh user@192.168.1.45
```

`user` - имя пользователя на сервере с правами `sudo`
`192.168.1.45` - IP-адрес удаленного сервера

Подразумевается, что такое подключение уже настроено и есть возможность подключаться по SSH. Если нет, то сначала его нужно настроить. Здесь это опустим.

Далее, необходимо, чтобы на сервере был установлен `python3`, `pip` и `python venv`. Тоже опустим, предполагая, что эти пакеты есть.

Сначала нужно на удаленном сервере создать директорию, в которой будет установлено виртуальное окружение.

```shell
mkdir projects/jupyter_projects
```

Перейти в новую директорию:

```shell
cd projects/jupyter_projects
```

Создать в директории виртуальное окружение:

```shell
python3 -m venv .venv
```

Активировать виртуальное окружение:

```shell
source .venv/bin/activate
```

Перед командной строкой в скобках появится название виртуального окружения:

```
(venv)mike@ubuntuml:~/projects/jupyter$
```

Далее, необходимо установить jupyter notebook (при активированном виртуальном окружении):

```shell
python3 -m pip install jupyter
```

Если установка прошла нормально, можно запустить jupyter notebook командой:

```shell
jupyter notebook
```

На выходе будет что-то типа:

```output
[I 19:46:22.365 NotebookApp] 0 active kernels
[I 19:46:22.366 NotebookApp] The Jupyter Notebook is running at:
[I 19:46:22.366 NotebookApp] http://localhost:8888/?token=Example_Jupyter_Token_3cadb8b8b7005d9a46ca4d6675
[I 19:46:22.366 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).
[W 19:46:22.366 NotebookApp] No web browser found: could not locate runnable browser.
[C 19:46:22.367 NotebookApp]

    Copy/paste this URL into your browser when you connect for the first time,
    to login with a token:
        http://localhost:8888/?token=Example_Jupyter_Token_3cadb8b8b7005d9a46ca4d6675&t
```

На этом этапе мы убедились, что все работает. Теперь можно остановить jupyter, нажав `ctrl + С` и подтвердив выход, нажав `y`, а затем `Enter`

Теперь нужно отключиться от удаленного сервера, отправив:

```shell
exit
```

Далее, на локальном компьютере в терминале нужно создать SSH-туннель, выполнив команду:

```shell
ssh -L 8777:localhost:8888 mike@192.168.1.45
```

Здесь `-L` говорит создать туннель с пробросом портов с `8888`, на котором будет на удаленном сервере запущен `jupyter notebook`, на `8777` порт локального компьютера (`8777` можно заменить на любой другой свободный, часто это `8000`, но у меня он был занят джанго-сервером, поэтому я выбрал `8777`)

Если все норм, то по этой команде произойдет соединение с удаленным сервером и, возможно, будет запрошен пароль для пользователя (в примере - для пользователя `mike`). После ввода пароля будет установлено SSH-соединение.

Нужно перейти на удаленном сервере в директорию, где мы ранее устанавливали виртуальное окружение и активировать его, так же, как уже делали это:

```shell
cd projects/jupyter_projects
```

```shell
source .venv/bin/activate
```

И запустить jupyter notebook:

```shell
jupyter notebook
```

После чего на локальном компьютере нужно открыть новую вкладку в браузере и ввести адрес:

```
http://localhost:8777
```

Если все в порядке - откроется приветственное окно jupyter notebook и надо будет ввести токен, который можно увидеть в терминале на удаленном сервере. После чего можно будет создавать ноутбуки и выполнять в них код, который будет выполняться на удаленном сервере, а в браузере будет отображаться результат.